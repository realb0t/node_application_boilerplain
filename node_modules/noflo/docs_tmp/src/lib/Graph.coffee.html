<!DOCTYPE html><html><head><title>Graph.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../src/lib/InternalSocket.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">InternalSocket.coffee</span></a><a href="../../src/lib/Component.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">Component.coffee</span></a><a href="../../src/lib/Server.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">Server.coffee</span></a><a href="../../src/lib/Fbp.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">Fbp.coffee</span></a><a href="../../src/lib/Graph.coffee.html" class="source selected"><span class="base_path">src / lib / </span><span class="file_name">Graph.coffee</span></a><a href="../../src/lib/Port.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">Port.coffee</span></a><a href="../../src/lib/NoFlo.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">NoFlo.coffee</span></a><a href="../../src/lib/Utils.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">Utils.coffee</span></a><a href="../../src/lib/ArrayPort.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">ArrayPort.coffee</span></a><a href="../../src/lib/shell.coffee.html" class="source "><span class="base_path">src / lib / </span><span class="file_name">shell.coffee</span></a><a href="../../src/bin/noflo.coffee.html" class="source "><span class="base_path">src / bin / </span><span class="file_name">noflo.coffee</span></a><a href="../../src/components/GroupByPacket.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">GroupByPacket.coffee</span></a><a href="../../src/components/ParseJson.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ParseJson.coffee</span></a><a href="../../src/components/Merge.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Merge.coffee</span></a><a href="../../src/components/ReadDocument.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ReadDocument.coffee</span></a><a href="../../src/components/ScrapeHtml.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ScrapeHtml.coffee</span></a><a href="../../src/components/ParseXml.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ParseXml.coffee</span></a><a href="../../src/components/SliceArray.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">SliceArray.coffee</span></a><a href="../../src/components/SetPropertyValue.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">SetPropertyValue.coffee</span></a><a href="../../src/components/ReadDir.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ReadDir.coffee</span></a><a href="../../src/components/Graph.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Graph.coffee</span></a><a href="../../src/components/DuplicateProperty.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">DuplicateProperty.coffee</span></a><a href="../../src/components/ReadFileRaw.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ReadFileRaw.coffee</span></a><a href="../../src/components/HTTP/Server.coffee.html" class="source "><span class="base_path">src / components / HTTP / </span><span class="file_name">Server.coffee</span></a><a href="../../src/components/HTTP/BasicAuth.coffee.html" class="source "><span class="base_path">src / components / HTTP / </span><span class="file_name">BasicAuth.coffee</span></a><a href="../../src/components/HTTP/SendResponse.coffee.html" class="source "><span class="base_path">src / components / HTTP / </span><span class="file_name">SendResponse.coffee</span></a><a href="../../src/components/HTTP/WriteResponse.coffee.html" class="source "><span class="base_path">src / components / HTTP / </span><span class="file_name">WriteResponse.coffee</span></a><a href="../../src/components/HTTP/Profiler.coffee.html" class="source "><span class="base_path">src / components / HTTP / </span><span class="file_name">Profiler.coffee</span></a><a href="../../src/components/Counter.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Counter.coffee</span></a><a href="../../src/components/Template.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Template.coffee</span></a><a href="../../src/components/SetProperty.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">SetProperty.coffee</span></a><a href="../../src/components/Replace.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Replace.coffee</span></a><a href="../../src/components/WebService/CouchDB/ReadDocument.coffee.html" class="source "><span class="base_path">src / components / WebService / CouchDB / </span><span class="file_name">ReadDocument.coffee</span></a><a href="../../src/components/WebService/CouchDB/GetChanges.coffee.html" class="source "><span class="base_path">src / components / WebService / CouchDB / </span><span class="file_name">GetChanges.coffee</span></a><a href="../../src/components/WebService/CouchDB/WriteDocument.coffee.html" class="source "><span class="base_path">src / components / WebService / CouchDB / </span><span class="file_name">WriteDocument.coffee</span></a><a href="../../src/components/WebService/CouchDB/OpenDatabase.coffee.html" class="source "><span class="base_path">src / components / WebService / CouchDB / </span><span class="file_name">OpenDatabase.coffee</span></a><a href="../../src/components/WebService/CouchDB/ReadDocumentAttachment.coffee.html" class="source "><span class="base_path">src / components / WebService / CouchDB / </span><span class="file_name">ReadDocumentAttachment.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadHours.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadHours.coffee</span></a><a href="../../src/components/WebService/Basecamp/BasecampComponent.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">BasecampComponent.coffee</span></a><a href="../../src/components/WebService/Basecamp/ConvertToJson.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ConvertToJson.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadProjects.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadProjects.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadTaskLists.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadTaskLists.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadProjectHours.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadProjectHours.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadTasks.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadTasks.coffee</span></a><a href="../../src/components/WebService/Basecamp/ReadProject.coffee.html" class="source "><span class="base_path">src / components / WebService / Basecamp / </span><span class="file_name">ReadProject.coffee</span></a><a href="../../src/components/GetObjectKey.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">GetObjectKey.coffee</span></a><a href="../../src/components/RemoveGroups.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">RemoveGroups.coffee</span></a><a href="../../src/components/UniquePacket.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">UniquePacket.coffee</span></a><a href="../../src/components/CreateDate.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">CreateDate.coffee</span></a><a href="../../src/components/Split.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Split.coffee</span></a><a href="../../src/components/Kick.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Kick.coffee</span></a><a href="../../src/components/Output.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Output.coffee</span></a><a href="../../src/components/Callback.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Callback.coffee</span></a><a href="../../src/components/GroupByObjectKey.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">GroupByObjectKey.coffee</span></a><a href="../../src/components/RemoveProperty.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">RemoveProperty.coffee</span></a><a href="../../src/components/MapGroup.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">MapGroup.coffee</span></a><a href="../../src/components/WriteFileRaw.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">WriteFileRaw.coffee</span></a><a href="../../src/components/UniqueArray.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">UniqueArray.coffee</span></a><a href="../../src/components/FilterPropertyValue.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">FilterPropertyValue.coffee</span></a><a href="../../src/components/MapPropertyValue.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">MapPropertyValue.coffee</span></a><a href="../../src/components/SplitArray.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">SplitArray.coffee</span></a><a href="../../src/components/Stat.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Stat.coffee</span></a><a href="../../src/components/FilterProperty.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">FilterProperty.coffee</span></a><a href="../../src/components/FlattenObject.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">FlattenObject.coffee</span></a><a href="../../src/components/CreateObject.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">CreateObject.coffee</span></a><a href="../../src/components/SplitStr.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">SplitStr.coffee</span></a><a href="../../src/components/Base64Encode.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">Base64Encode.coffee</span></a><a href="../../src/components/ReadFile.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">ReadFile.coffee</span></a><a href="../../src/components/MapProperty.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">MapProperty.coffee</span></a><a href="../../src/components/PropertiesToObjects.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">PropertiesToObjects.coffee</span></a><a href="../../src/components/CollectGroups.coffee.html" class="source "><span class="base_path">src / components / </span><span class="file_name">CollectGroups.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>Graph.coffee</h1><div class="filepath">src/lib/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><pre><code>NoFlo - Flow-Based Programming for Node.js
(c) 2011 Henri Bergius, Nemein
NoFlo may be freely distributed under the MIT license
</code></pre>
</td><td class="code"><div class="highlight"><pre><span class="nv">fs = </span><span class="nx">require</span> <span class="s1">&#39;fs&#39;</span>
<span class="nv">events = </span><span class="nx">require</span> <span class="s1">&#39;events&#39;</span>
<span class="nv">fbp = </span><span class="nx">require</span> <span class="s1">&#39;./Fbp&#39;</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><h1>NoFlo network graph</h1>

<p>This class represents an abstract NoFlo graph containing nodes
connected to each other with edges.</p>

<p>These graphs can be used for visualization and sketching, but
also are the way to start a NoFlo network.</p>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nx">Graph</span> <span class="k">extends</span> <span class="nx">events</span><span class="p">.</span><span class="nx">EventEmitter</span>
    <span class="nv">name: </span><span class="s1">&#39;&#39;</span>
    <span class="nv">nodes: </span><span class="p">[]</span>
    <span class="nv">edges: </span><span class="p">[]</span>
    <span class="nv">initializers: </span><span class="p">[]</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><h2>Creating new graphs</h2>

<p>Graphs are created by simply instantiating the Graph class
and giving it a name:</p>

<pre><code>myGraph = new Graph 'My very cool graph'
</code></pre>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">constructor: </span><span class="nf">(@name) -&gt;</span>
        <span class="vi">@nodes = </span><span class="p">[]</span>
        <span class="vi">@edges = </span><span class="p">[]</span>
        <span class="vi">@initializers = </span><span class="p">[]</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><h2>Adding a node to the graph</h2>

<p>Nodes are identified by an ID unique to the graph. Additionally,
a node may contain information on what NoFlo component it is and
possible display coordinates.</p>

<p>For example:</p>

<pre><code>myGraph.addNode 'Read, 'ReadFile',
  x: 91
  y: 154
</code></pre>

<p>Addition of a node will emit the <code>addNode</code> event.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">addNode: </span><span class="nf">(id, component, display) -&gt;</span>
        <span class="nv">node =</span>
            <span class="nv">id: </span><span class="nx">id</span>
            <span class="nv">component: </span><span class="nx">component</span>
            <span class="nv">display: </span><span class="nx">display</span>
        <span class="nx">@nodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">node</span>
        <span class="nx">@emit</span> <span class="s1">&#39;addNode&#39;</span><span class="p">,</span> <span class="nx">node</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><h2>Removing a node from the graph</h2>

<p>Existing nodes can be removed from a graph by their ID. This
will remove the node and also remove all edges connected to it.</p>

<pre><code>myGraph.removeNode 'Read'
</code></pre>

<p>Once the node has been removed, the <code>removeNode</code> event will be
emitted.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">removeNode: </span><span class="nf">(id) -&gt;</span>
        <span class="nv">node =</span>
            <span class="nv">id: </span><span class="nx">id</span>

        <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">@edges</span>
            <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span>
                <span class="nx">@removeEdge</span> <span class="nx">edge</span>
            <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span>
                <span class="nx">@removeEdge</span> <span class="nx">edge</span>

        <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="nx">@initializers</span>
            <span class="k">if</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span>
                <span class="nx">@removeEdge</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>

        <span class="nx">@emit</span> <span class="s1">&#39;removeNode&#39;</span><span class="p">,</span> <span class="nx">node</span>

        <span class="k">if</span> <span class="nx">@nodes</span><span class="p">.</span><span class="nx">indexOf</span> <span class="nx">node</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
            <span class="nx">@nodes</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">@nodes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">node</span><span class="p">),</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><h2>Getting a node</h2>

<p>Nodes objects can be retrieved from the graph by their ID:</p>

<pre><code>myNode = myGraph.getNode 'Read'
</code></pre>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">getNode: </span><span class="nf">(id) -&gt;</span>
        <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">@nodes</span>
            <span class="k">return</span> <span class="nx">node</span> <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">is</span> <span class="nx">id</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><h2>Connecting nodes</h2>

<p>Nodes can be connected by adding edges between a node's outport
and another node's inport:</p>

<pre><code>myGraph.addEdge 'Read', 'out', 'Display', 'in'
</code></pre>

<p>Adding an edge will emit the <code>addEdge</code> event.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">addEdge: </span><span class="nf">(outNode, outPort, inNode, inPort) -&gt;</span>
        <span class="nv">edge =</span>
            <span class="nv">from:</span>
                <span class="nv">node: </span><span class="nx">outNode</span>
                <span class="nv">port: </span><span class="nx">outPort</span>
            <span class="nv">to:</span>
                <span class="nv">node: </span><span class="nx">inNode</span>
                <span class="nv">port: </span><span class="nx">inPort</span>
        <span class="nx">@edges</span><span class="p">.</span><span class="nx">push</span> <span class="nx">edge</span>
        <span class="nx">@emit</span> <span class="s1">&#39;addEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><h2>Disconnected nodes</h2>

<p>Connections between nodes can be removed by providing the
node and port to disconnect. The specified node and port can
be either the outport or the inport of the connection:</p>

<pre><code>myGraph.removeEdge 'Read', 'out'
</code></pre>

<p>or:</p>

<pre><code>myGraph.removeEdge 'Display', 'in'
</code></pre>

<p>Removing a connection will emit the <code>removeEdge</code> event.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">removeEdge: </span><span class="nf">(node, port) -&gt;</span>
        <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span><span class="nx">index</span> <span class="k">in</span> <span class="nx">@edges</span>
            <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span>
                <span class="nx">@emit</span> <span class="s1">&#39;removeEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>
                <span class="nx">@edges</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span>
                <span class="nx">@emit</span> <span class="s1">&#39;removeEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>
                <span class="nx">@edges</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="nx">edge</span><span class="p">,</span><span class="nx">index</span> <span class="k">in</span> <span class="nx">@initializers</span>
            <span class="k">if</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span> <span class="o">is</span> <span class="nx">node</span> <span class="o">and</span> <span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span> <span class="o">is</span> <span class="nx">port</span>
                <span class="nx">@emit</span> <span class="s1">&#39;removeEdge&#39;</span><span class="p">,</span> <span class="nx">edge</span>
                <span class="nx">@initializers</span><span class="p">.</span><span class="nx">splice</span> <span class="nx">index</span><span class="p">,</span> <span class="mi">1</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><h2>Adding Initial Information Packets</h2>

<p>Initial Information Packets (IIPs) can be used for sending data
to specified node inports without a sending node instance.</p>

<p>IIPs are especially useful for sending configuration information
to components at NoFlo network start-up time. This could include
filenames to read, or network ports to listen to.</p>

<pre><code>myGraph.addInitial 'somefile.txt', 'Read', 'source'
</code></pre>

<p>Adding an IIP will emit a <code>addEdge</code> event.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">addInitial: </span><span class="nf">(data, node, port) -&gt;</span>
        <span class="nv">initializer =</span>
            <span class="nv">from:</span>
                <span class="nv">data: </span><span class="nx">data</span>
            <span class="nv">to:</span>
                <span class="nv">node: </span><span class="nx">node</span>
                <span class="nv">port: </span><span class="nx">port</span>
        <span class="nx">@initializers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">initializer</span>
        <span class="nx">@emit</span> <span class="s1">&#39;addEdge&#39;</span><span class="p">,</span> <span class="nx">initializer</span>

    <span class="nv">toDOT: </span><span class="o">-&gt;</span>
        <span class="nv">cleanID = </span><span class="nf">(id) -&gt;</span>
            <span class="nx">id</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/\s*/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="nv">cleanPort = </span><span class="nf">(port) -&gt;</span>
            <span class="nx">port</span><span class="p">.</span><span class="nx">replace</span> <span class="sr">/\./g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

        <span class="nv">dot = </span><span class="s2">&quot;digraph {\n&quot;</span>

        <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">@nodes</span>
            <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    #{cleanID(node.id)} [shape=box]\n&quot;</span>

        <span class="k">for</span> <span class="nx">initializer</span><span class="p">,</span> <span class="nx">id</span> <span class="k">in</span> <span class="nx">@initializers</span>
            <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    data#{id} -&gt; #{cleanID(initializer.to.node)} [label=&#39;#{cleanPort(initializer.to.port)}&#39;]\n&quot;</span> 

        <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">@edges</span>
            <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;    #{cleanID(edge.from.node)} -&gt; #{cleanID(edge.to.node)}[label=&#39;#{cleanPort(edge.from.port)}&#39;]\n&quot;</span>

        <span class="nx">dot</span> <span class="o">+=</span> <span class="s2">&quot;}&quot;</span>

        <span class="k">return</span> <span class="nx">dot</span>

    <span class="nv">toYUML: </span><span class="o">-&gt;</span>
        <span class="nv">yuml = </span><span class="p">[]</span>

        <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="nx">@initializers</span>
            <span class="nx">yuml</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;(start)[#{initializer.to.port}]-&gt;(#{initializer.to.node})&quot;</span><span class="p">;</span>

        <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">@edges</span>
            <span class="nx">yuml</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;(#{edge.from.node})[#{edge.from.port}]-&gt;(#{edge.to.node})&quot;</span>
        <span class="nx">yuml</span><span class="p">.</span><span class="nx">join</span> <span class="s2">&quot;,&quot;</span>

    <span class="nv">toJSON: </span><span class="o">-&gt;</span>
        <span class="nv">json = </span>
            <span class="nv">properties:</span>
                <span class="nv">name: </span><span class="nx">@name</span>
            <span class="nv">processes: </span><span class="p">{}</span>
            <span class="nv">connections: </span><span class="p">[]</span>

        <span class="k">for</span> <span class="nx">node</span> <span class="k">in</span> <span class="nx">@nodes</span>
            <span class="nx">json</span><span class="p">.</span><span class="nx">processes</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span>
                <span class="nv">component: </span><span class="nx">node</span><span class="p">.</span><span class="nx">component</span>
            <span class="k">if</span> <span class="nx">node</span><span class="p">.</span><span class="nx">display</span>
                <span class="nx">json</span><span class="p">.</span><span class="nx">processes</span><span class="p">[</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nv">display = </span><span class="nx">node</span><span class="p">.</span><span class="nx">display</span>

        <span class="k">for</span> <span class="nx">edge</span> <span class="k">in</span> <span class="nx">@edges</span>
            <span class="nx">json</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">push</span>
                <span class="nv">src:</span>
                    <span class="nv">process: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">node</span>
                    <span class="nv">port: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">port</span>
                <span class="nv">tgt:</span>
                    <span class="nv">process: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span>
                    <span class="nv">port: </span><span class="nx">edge</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>

        <span class="k">for</span> <span class="nx">initializer</span> <span class="k">in</span> <span class="nx">@initializers</span>
            <span class="nx">json</span><span class="p">.</span><span class="nx">connections</span><span class="p">.</span><span class="nx">push</span>
                <span class="nv">data: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">data</span>
                <span class="nv">tgt:</span>
                    <span class="nv">process: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">node</span>
                    <span class="nv">port: </span><span class="nx">initializer</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">port</span>

        <span class="nx">json</span>

    <span class="nv">save: </span><span class="nf">(file, success) -&gt;</span>
        <span class="nv">json = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">@toJSON</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">4</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span> <span class="s2">&quot;#{file}.json&quot;</span><span class="p">,</span> <span class="nx">json</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="nf">(err, data) -&gt;</span>
            <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>
            <span class="nx">success</span> <span class="nx">file</span>

<span class="nv">exports.Graph = </span><span class="nx">Graph</span>

<span class="nv">exports.createGraph = </span><span class="nf">(name) -&gt;</span>
    <span class="k">new</span> <span class="nx">Graph</span> <span class="nx">name</span>

<span class="nv">exports.loadJSON = </span><span class="nf">(definition, success) -&gt;</span>
    <span class="nv">graph = </span><span class="k">new</span> <span class="nx">Graph</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">properties</span><span class="p">.</span><span class="nx">name</span>

    <span class="k">for</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">def</span> <span class="k">of</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">processes</span>
        <span class="nx">graph</span><span class="p">.</span><span class="nx">addNode</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">def</span><span class="p">.</span><span class="nx">component</span><span class="p">,</span> <span class="nx">def</span><span class="p">.</span><span class="nx">display</span>

    <span class="k">for</span> <span class="nx">conn</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">.</span><span class="nx">connections</span>
        <span class="k">if</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">data</span>
            <span class="nx">graph</span><span class="p">.</span><span class="nx">addInitial</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
            <span class="k">continue</span>
        <span class="nx">graph</span><span class="p">.</span><span class="nx">addEdge</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">process</span><span class="p">,</span> <span class="nx">conn</span><span class="p">.</span><span class="nx">tgt</span><span class="p">.</span><span class="nx">port</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>

    <span class="nx">success</span> <span class="nx">graph</span>

<span class="nv">exports.loadFile = </span><span class="nf">(file, success) -&gt;</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span> <span class="nx">file</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="nf">(err, data) -&gt;</span>
        <span class="k">throw</span> <span class="nx">err</span> <span class="k">if</span> <span class="nx">err</span>

        <span class="k">if</span> <span class="nx">file</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">()</span> <span class="o">is</span> <span class="s1">&#39;fbp&#39;</span>
            <span class="k">return</span> <span class="nx">exports</span><span class="p">.</span><span class="nx">loadFBP</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">success</span>

        <span class="nv">definition = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">data</span>
        <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">success</span>

<span class="nv">exports.loadFBP = </span><span class="nf">(fbpData, success) -&gt;</span>
    <span class="nv">parser = </span><span class="k">new</span> <span class="nx">fbp</span><span class="p">.</span><span class="nx">Fbp</span>
    <span class="nv">definition = </span><span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">fbpData</span>
    <span class="nx">exports</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="nx">definition</span><span class="p">,</span> <span class="nx">success</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Apr 03 2012 15:29:46 GMT+0200 (CEST)  </div><div id="projectname"><a href="../../index.html">NoFlo</a></div></div></body></html>